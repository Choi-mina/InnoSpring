<!DOCTYPE html>
<html lang="ko" xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">
<head>
    <link href="https://fonts.googleapis.com/css?family=Cairo&display=swap" rel="stylesheet" />
    <link href="../css/home.css" rel="stylesheet" type="text/css"/>
    <title>Schedule</title>
    <style>
        * {
            box-sizing: border-box;
        }
        body {
            font-size: 16px;
            overflow: scroll;
        }
        .schedule-div {
            width: 100%;
            height: 100%; /* 부모 div의 크기 100% */
            background-repeat: no-repeat;
            background-position: center center;
            background-size: cover;
            padding: 10px 104px;
            position: absolute;
            top: 100px;
            left: 0;
        }

        .date-month {
            text-align: center;
            margin-bottom: 20px; /* 날짜 상단부와 버튼들 사이에 약간의 여백 */
            font-size: 24px; /* 날짜 크기 키우기 */
        }

        table.date-month {
            width: 80%; /* 테이블 크기 조정 */
            table-layout: fixed; /* 셀의 크기를 고정 */
            font-size: 20px; /* 전체 테이블의 글자 크기 증가 */
            margin-top: 20px; /* 테이블 상단 여백 추가 */
            margin-left: auto; /* 좌우 여백을 자동으로 설정하여 중앙에 배치 */
            margin-right: auto; /* 좌우 여백을 자동으로 설정하여 중앙에 배치 */
        }

        th, td {
            width: 14.28%; /* 7일 요일 기준으로 너비 설정 */
            height: 80px; /* 셀 높이 설정 */
            text-align: center;
            font-size: 20px; /* 셀 내 글자 크기 증가 */
            padding: 10px;
            vertical-align: middle;
        }

        td a {
            display: block;
            width: 100%;
            height: 100%;
            line-height: 60px; /* 셀 내부의 텍스트 가운데 정렬 */
            font-size: 18px;
        }

        #month-prev {
            background-color: transparent; /* 배경색 없음 */
            border-color: transparent;
            padding: 10px 20px; /* 버튼 크기 조정 */
            font-size: 16px; /* 글자 크기 */
            cursor: pointer; /* 클릭할 때 커서 모양 */
            width: 80px; /* 버튼 너비 */
            height: 80px; /* 버튼 높이 */
            text-align: center; /* 텍스트 가운데 정렬 */
            line-height: 50px; /* 텍스트 세로 가운데 정렬 */
        }

        #today-btn {
            background-color: transparent; /* 배경색 없음 */
            border: transparent;
            padding: 10px 20px; /* 버튼 크기 조정 */
            font-size: 16px; /* 글자 크기 */
            cursor: pointer; /* 클릭할 때 커서 모양 */
            width: 80px; /* 버튼 너비 */
            height: 80px; /* 버튼 높이 */
            text-align: center; /* 텍스트 가운데 정렬 */
            line-height: 50px; /* 텍스트 세로 가운데 정렬 */
        }

        #month-next {
            background-color: transparent; /* 배경색 없음 */
            border-color: transparent;
            padding: 10px 20px; /* 버튼 크기 조정 */
            font-size: 16px; /* 글자 크기 */
            cursor: pointer; /* 클릭할 때 커서 모양 */
            width: 80px; /* 버튼 너비 */
            height: 80px; /* 버튼 높이 */
            text-align: center; /* 텍스트 가운데 정렬 */
            line-height: 50px; /* 텍스트 세로 가운데 정렬 */
        }

        #today-btn:hover {
            border-color: #555; /* 호버 시 테두리 색상 변경 */
        }

        td.sun {
            color: red;
        }

        td.sat {
            color: blue;
        }

        td.today a {
            background-color: rgba(232, 217, 255, 1);
            padding: 5px 10px;
            border-radius: 10px;
            display: inline-block;
        }
    </style>
</head>
<body>
<th:block layout:fragment="header" th:include="@{fragments/header}"></th:block>
<div class="schedule-div">
    <div class="date-wrap">
        <div class="date-month">
            <span id="month-this">2022.05</span>
            <div class="button_wrap">
                <button type="button" id="month-prev" class="month-move" data-ym="2022-04-01"> < </button>
                <button type="button" id="today-btn">Today</button>
                <button type="button" id="month-next" class="month-move" data-ym="2022-06-01"> > </button>
            </div>
        </div>
        <table class="date-month">
            <thead>
            <tr>
                <th>일</th>
                <th>월</th>
                <th>화</th>
                <th>수</th>
                <th>목</th>
                <th>금</th>
                <th>토</th>
            </tr>
            </thead>
            <tbody id="tbl-month">
            <tr>
                <td class="sun"><a>1</a></td>
                <td class=""><a href="/news/schedule?date=2022-05-02">2</a></td>
                <td class=""><a>3</a></td>
                <td class=""><a>4</a></td>
                <td class="today"><a>5</a></td>
                <td class=""><a>6</a></td>
                <td class="sat"><a>7</a></td>
            </tr>
            <!-- 행 반복 -->
            <tr>
                <td class="sun"><a>29</a></td>
                <td class=""><a>30</a></td>
                <td class=""><a>31</a></td>
                <td class=""><a></a></td>
                <td class=""><a></a></td>
                <td class=""><a></a></td>
                <td class="sat"></a></td>
            </tr>
            </tbody>
        </table>
    </div>
</div>
<th:block layout:fragment="footer" th:include="@{fragments/footer}"></th:block>
</body>
<script th:src="@{/common/common.ajax.js}"></script>
<script>
    function prevMonth(date) {
        var target = new Date(date);
        target.setDate(1);
        target.setMonth(target.getMonth() - 1);
        return getYmd(target);
    }

    function nextMonth(date) {
        var target = new Date(date);
        target.setDate(1);
        target.setMonth(target.getMonth() + 1);
        return getYmd(target);
    }

    function getYmd(target) {
        // IE에서 날짜 문자열에 0이 없으면 인식 못함
        var month = ('0' + (target.getMonth() + 1)).slice(-2);
        return [target.getFullYear(), month, '01'].join('-');
    }

    function fullDays(date) {
        var target = new Date(date);
        var year = target.getFullYear();
        var month = target.getMonth();

        var firstWeekDay = new Date(year, month, 1).getDay();
        var thisDays = new Date(year, month + 1, 0).getDate();

        // 월 표시 달력이 가지는 셀 갯수는 3가지 가운데 하나이다.
        // var cell = [28, 35, 42].filter(n => n >= (firstWeekDay + thisDays)).shift();
        var cell = [28, 35, 42].filter(function (n) {
            return n >= (firstWeekDay + thisDays);
        }).shift();

        // 셀 초기화, IE에서 Array.fill()을 지원하지 않아서 변경
        // var days = new Array(cell).fill({date: '', dayNum: '', today: false});
        var days = []
        for (var i = 0; i < cell; i++) {
            days[i] = {
                date: '',
                dayNum: '',
                today: false
            };
        }

        var now = new Date();
        var today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        var inDate;
        for (var index = firstWeekDay, i = 1; i <= thisDays; index++, i++) {
            inDate = new Date(year, month, i);
            days[index] = {
                date: i,
                dayNum: inDate.getDay(),
                today: (inDate.getTime() === today.getTime())
            };
        }

        return days;
    }
    function drawMonth(date) {
        $('#month-this').text(date.substring(0, 7).replace('-', '.'));
        $('#month-prev').data('ym', prevMonth(date));
        $('#month-next').data('ym', nextMonth(date));

        $('#tbl-month').empty();

        var td = '<td class="__REST__ __TODAY__"><a __HREF__>__DATE__</a></td>';
        var href = '/depart/schedule?date=' + date.substring(0, 8);
        var hasEvent;
        var tdClass;
        var week = null;
        var days = fullDays(date);
        for (var i = 0, length = days.length; i < length; i += 7) {
            // 전체 셀을 주단위로 잘라서 사용
            week = days.slice(i, i + 7);

            var $tr = $('<tr></tr>');
            week.forEach(function (obj, index) {
                // 매주 수요일에 이벤트가 있다고 가정
                hasEvent = (index === 3);
                tdClass = (index === 0)? 'sun': '';
                tdClass = (index === 6)? 'sat': tdClass;

                $tr.append(td.replace('__REST__', tdClass)
                    .replace('__TODAY__', (obj['today'])? 'today': '')
                    .replace('__HREF__', (hasEvent)? 'href="'+ href + ('0' + obj['date']).slice(-2) +'"': '')
                    .replace('__DATE__', obj['date']));
            });
            $('#tbl-month').append($tr);
        }
    }

    $(function () {
        var date = (new Date()).toISOString().substring(0, 10);
        drawMonth(date);

        $('.month-move').on('click', function (e) {
            e.preventDefault();

            drawMonth($(this).data('ym'));
        });

        // Today 버튼 클릭 시 오늘 날짜로 이동
        $('#today-btn').on('click', function (e) {
            e.preventDefault();
            var today = new Date().toISOString().substring(0, 10);
            drawMonth(today);  // 오늘 날짜로 달력 그리기
        });
    });
</script>
</html>